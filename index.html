<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#4F46E5" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Family Expenses" />
  <title>Family Expense Tracker</title>

  <!-- PWA -->
  <link rel="manifest" href="./manifest.json" />
  <link rel="icon" type="image/png" href="./icon-192.png" />
  <link rel="apple-touch-icon" href="./icon-192.png" />

  <!-- Libs -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    * { margin:0; padding:0; box-sizing:border-box }
    body {
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
      -webkit-font-smoothing:antialiased;
      background:linear-gradient(135deg,#dbeafe 0%,#e0e7ff 100%);
      min-height:100vh;
    }
    #root { min-height:100vh }
    .app-loading { display:flex; align-items:center; justify-content:center; min-height:100vh; background:linear-gradient(135deg,#dbeafe 0%,#e0e7ff 100%) }
    .app-loading::after { content:"Loading..."; font-size:24px; color:#4F46E5; font-weight:bold }
  </style>
</head>
<body>
  <div id="root" class="app-loading"></div>

  <!-- IMPORTANT: presets enable JSX in-browser -->
  <script type="text/babel" data-presets="env,react">
    const { useState, useEffect } = React;

    // --- icons (inline svgs) ---
    const Plus = ({ size=24, className="" }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M5 12h14"/><path d="M12 5v14"/></svg>
    );
    const Trash2 = ({ size=24 }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
    );
    const ShoppingCart = ({ size=24, className="" }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>
    );
    const LogOut = ({ size=24 }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>
    );
    const Calendar = ({ size=24 }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>
    );
    const DollarSign = ({ size=24 }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
    );
    const TrendingDown = ({ size=24 }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/><polyline points="17 18 23 18 23 12"/></svg>
    );
    const MessageSquare = ({ size=24, className="" }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
    );
    const BarChart3 = ({ size=24, className="" }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>
    );

    function FamilyExpenseTracker() {
      // --- localStorage lazy init (prevents first-render wipe) ---
      const [expenses, setExpenses] = useState(() => {
        try { return JSON.parse(localStorage.getItem('familyExpenses')) || []; } catch { return []; }
      });
      const [users, setUsers] = useState(() => {
        try { return JSON.parse(localStorage.getItem('familyUsers')) || []; } catch { return []; }
      });

      const [currentUser, setCurrentUser] = useState(null);
      const [isAdmin, setIsAdmin] = useState(false);

      const [showAuth, setShowAuth] = useState(true);
      const [authMode, setAuthMode] = useState('login');
      const [username, setUsername] = useState('');
      const [password, setPassword] = useState('');
      const [confirmPassword, setConfirmPassword] = useState('');
      const [authError, setAuthError] = useState('');
      const [formError, setFormError] = useState('');

      const [amount, setAmount] = useState('');
      const [category, setCategory] = useState('Groceries');
      const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);
      const [comment, setComment] = useState('');
      const [viewMode, setViewMode] = useState('daily');

      const ADMIN_PASSWORD = 'sultannaser99'; // visible in source
      const categories = ['Groceries','Dining Out','Transportation','Utilities','Entertainment','Healthcare','Shopping','Education','Bills','Other'];
      const quickAmounts = [10,20,50,100,200];

      // persist to localStorage
      useEffect(() => { localStorage.setItem('familyExpenses', JSON.stringify(expenses)); }, [expenses]);
      useEffect(() => { localStorage.setItem('familyUsers', JSON.stringify(users)); }, [users]);

      const handleRegister = () => {
        setAuthError('');
        if (!username || !password || !confirmPassword) return setAuthError('‚ö†Ô∏è Please fill in all fields');
        if (username.length < 3) return setAuthError('‚ö†Ô∏è Username must be at least 3 characters');
        if (password.length < 4) return setAuthError('‚ö†Ô∏è Password must be at least 4 characters');
        if (password !== confirmPassword) return setAuthError('‚ö†Ô∏è Passwords do not match');
        if (users.some(u => u.username.toLowerCase() === username.toLowerCase())) return setAuthError('‚ö†Ô∏è Username already exists. Please choose another.');

        const newUser = { id: Date.now(), username, password, createdAt: new Date().toISOString() };
        setUsers([...users, newUser]);
        setUsername(''); setPassword(''); setConfirmPassword('');
        setAuthMode('login');
        setTimeout(() => setAuthError('‚úÖ Account created! Please login.'), 100);
      };

      const handleLogin = () => {
        setAuthError('');
        if (!username || !password) return setAuthError('‚ö†Ô∏è Please enter username and password');
        if (username.toLowerCase() === 'admin' && password === ADMIN_PASSWORD) {
          setIsAdmin(true); setCurrentUser({ username:'Admin', id:'admin' }); setShowAuth(false);
          setUsername(''); setPassword(''); return;
        }
        const user = users.find(u => u.username.toLowerCase() === username.toLowerCase() && u.password === password);
        if (user) { setCurrentUser(user); setIsAdmin(false); setShowAuth(false); setUsername(''); setPassword(''); }
        else setAuthError('‚ö†Ô∏è Invalid username or password. Please try again.');
      };

      const handleLogout = () => { setCurrentUser(null); setIsAdmin(false); setShowAuth(true); setUsername(''); setPassword(''); };

      const addExpense = () => {
        setFormError('');
        if (!amount) return setFormError('‚ö†Ô∏è Please enter an amount');
        const num = parseFloat(amount);
        if (num <= 0) return setFormError('‚ö†Ô∏è Amount must be greater than 0');
        if (num > 1000000) return setFormError('‚ö†Ô∏è Amount seems too large. Please check.');
        if (!currentUser) return setFormError('‚ö†Ô∏è Please log in again');

        const newExpense = {
          id: Date.now(), amount: num, category,
          userId: currentUser.id, username: currentUser.username,
          date: selectedDate, comment: comment.trim(), timestamp: new Date().toISOString()
        };
        setExpenses([newExpense, ...expenses]);
        setAmount(''); setComment(''); setFormError('‚úÖ Expense added successfully!');
        setTimeout(() => setFormError(''), 2000);
      };

      const deleteExpense = (id) => {
        if (window.confirm('Are you sure you want to delete this expense?')) {
          setExpenses(expenses.filter(exp => exp.id !== id));
        }
      };

      const getUserExpenses = () => {
        if (isAdmin) return expenses;
        if (!currentUser) return []; // guard when logged out
        return expenses.filter(exp => exp.userId === currentUser.id);
      };

      const getFilteredExpenses = () => {
        const userExpenses = getUserExpenses();
        const today = new Date(); today.setHours(23,59,59,999);
        const todayString = new Date().toISOString().split('T')[0];
        const sevenDaysAgo = new Date(today); sevenDaysAgo.setDate(today.getDate()-6); sevenDaysAgo.setHours(0,0,0,0);
        const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1); startOfMonth.setHours(0,0,0,0);
        switch (viewMode) {
          case 'daily':   return userExpenses.filter(exp => exp.date === todayString);
          case 'weekly':  return userExpenses.filter(exp => { const d = new Date(exp.date); return d >= sevenDaysAgo && d <= today; });
          case 'monthly': return userExpenses.filter(exp => { const d = new Date(exp.date); return d >= startOfMonth && d <= today; });
          default:        return userExpenses;
        }
      };

      const calculateTotal = (list) => list.reduce((s,e)=>s+e.amount,0);
      const getCategoryBreakdown = (list) =>
        Object.entries(list.reduce((a,e)=>{ a[e.category]=(a[e.category]||0)+e.amount; return a; },{}))
          .sort((a,b)=>b[1]-a[1]);

      // render auth BEFORE any totals (prevents touching currentUser when null)
      if (showAuth) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
            <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
              <div className="flex items-center justify-center mb-6">
                <div className="bg-indigo-600 p-4 rounded-xl"><ShoppingCart size={40} className="text-white" /></div>
              </div>
              <h1 className="text-3xl font-bold text-gray-800 text-center mb-2">Family Expense Tracker</h1>
              <p className="text-gray-500 text-center mb-6">{authMode === 'login' ? 'Login to your account' : 'Create a new account'}</p>
              <div className="flex gap-2 mb-6">
                <button onClick={()=>setAuthMode('login')} className={`flex-1 py-3 rounded-xl font-bold transition-all ${authMode==='login'?'bg-indigo-600 text-white':'bg-gray-100 text-gray-600'}`}>Login</button>
                <button onClick={()=>setAuthMode('register')} className={`flex-1 py-3 rounded-xl font-bold transition-all ${authMode==='register'?'bg-indigo-600 text-white':'bg-gray-100 text-gray-600'}`}>Register</button>
              </div>
              <div className="space-y-4">
                {authError && (
                  <div className={`p-4 rounded-xl ${authError.includes('‚úÖ') ? 'bg-green-50 border-2 border-green-500 text-green-700' : 'bg-red-50 border-2 border-red-500 text-red-700'}`}>
                    <p className="font-medium text-center">{authError}</p>
                  </div>
                )}
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Username</label>
                  <input type="text" value={username} onChange={(e)=>{setUsername(e.target.value); setAuthError('');}}
                         onKeyPress={(e)=> e.key==='Enter' && (authMode==='login'?handleLogin():handleRegister())}
                         placeholder="Enter username"
                         className={`w-full p-3 border-2 rounded-xl focus:border-indigo-500 focus:outline-none ${authError && !authError.includes('‚úÖ') ? 'border-red-300' : 'border-gray-200'}`} />
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Password</label>
                  <input type="password" value={password} onChange={(e)=>{setPassword(e.target.value); setAuthError('');}}
                         onKeyPress={(e)=> e.key==='Enter' && (authMode==='login'?handleLogin():handleRegister())}
                         placeholder="Enter password"
                         className={`w-full p-3 border-2 rounded-xl focus:border-indigo-500 focus:outline-none ${authError && !authError.includes('‚úÖ') ? 'border-red-300' : 'border-gray-200'}`} />
                </div>
                {authMode==='register' && (
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Confirm Password</label>
                    <input type="password" value={confirmPassword} onChange={(e)=>{setConfirmPassword(e.target.value); setAuthError('');}}
                           onKeyPress={(e)=> e.key==='Enter' && handleRegister()}
                           placeholder="Confirm password"
                           className={`w-full p-3 border-2 rounded-xl focus:border-indigo-500 focus:outline-none ${authError && !authError.includes('‚úÖ') ? 'border-red-300' : 'border-gray-200'}`} />
                  </div>
                )}
                <button onClick={authMode==='login'?handleLogin:handleRegister}
                        className="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold hover:bg-indigo-700 transition-all shadow-lg">
                  {authMode==='login' ? 'Login' : 'Create Account'}
                </button>
              </div>
            </div>
          </div>
        );
      }

      // compute after auth
      const filteredExpenses = getFilteredExpenses();
      const totalSpent = calculateTotal(filteredExpenses);
      const categoryBreakdown = getCategoryBreakdown(filteredExpenses);

      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
          <div className="max-w-6xl mx-auto">
            <div className="bg-white rounded-2xl shadow-xl p-6 mb-6">
              <div className="flex flex-col gap-4 mb-4">
                <div className="flex items-center justify-between">
                  <div className="flex items-center gap-3">
                    <div className="bg-indigo-600 p-3 rounded-xl"><ShoppingCart size={24} className="text-white" /></div>
                    <div>
                      <h1 className="text-xl md:text-3xl font-bold text-gray-800">{isAdmin?'üîê Admin':'My Expenses'}</h1>
                      <p className="text-sm text-gray-500"><strong>{currentUser.username}</strong></p>
                    </div>
                  </div>
                  <button onClick={handleLogout} className="flex items-center gap-1 px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-medium transition-all text-sm">
                    <LogOut size={16} /><span className="hidden sm:inline">Logout</span>
                  </button>
                </div>
                <div className="flex items-center justify-between">
                  <div className="text-left">
                    <p className="text-xs text-gray-500">{viewMode==='daily'?'Today':viewMode==='weekly'?'Last 7 Days':'This Month'}</p>
                    <p className="text-2xl md:text-3xl font-bold text-indigo-600">AED {totalSpent.toFixed(2)}</p>
                  </div>
                </div>
              </div>
              <div className="flex gap-2">
                {['daily','weekly','monthly'].map(mode=>(
                  <button key={mode} onClick={()=>setViewMode(mode)}
                          className={`flex-1 py-2 px-2 text-sm md:text-base rounded-lg font-medium capitalize transition-all ${viewMode===mode?'bg-indigo-600 text-white shadow-md':'bg-gray-100 text-gray-600 hover:bg-gray-200'}`}>
                    {mode}
                  </button>
                ))}
              </div>
            </div>

            <AddExpenseSection {...{isAdmin,selectedDate,setSelectedDate,category,setCategory,categories,amount,setAmount,formError,quickAmounts,comment,setComment,addExpense,Plus,Calendar,TrendingDown,DollarSign,MessageSquare}} />

            {categoryBreakdown.length>0 && (
              <div className="bg-white rounded-2xl shadow-xl p-4 md:p-6 mb-6">
                <h2 className="text-lg md:text-xl font-bold text-gray-800 mb-4 flex items-center gap-2"><BarChart3 size={20} className="text-indigo-600" />Category Breakdown</h2>
                <div className="space-y-3">
                  {categoryBreakdown.map(([cat, amount])=>{
                    const pct = (amount/totalSpent)*100;
                    return (
                      <div key={cat}>
                        <div className="flex justify-between mb-1 items-center">
                          <span className="font-medium text-gray-700 text-sm md:text-base">{cat}</span>
                          <div className="text-right"><span className="font-bold text-indigo-600 text-sm md:text-base">AED {amount.toFixed(2)}</span><span className="text-xs text-gray-500 ml-1 md:ml-2">({pct.toFixed(1)}%)</span></div>
                        </div>
                        <div className="w-full bg-gray-200 rounded-full h-2 md:h-3">
                          <div className="bg-gradient-to-r from-indigo-500 to-indigo-600 h-2 md:h-3 rounded-full transition-all duration-500" style={{width:`${pct}%`}} />
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            )}

            <ExpenseList {...{isAdmin,filteredExpenses,Trash2,MessageSquare,Calendar,deleteExpense,ShoppingCart}} />
          </div>
        </div>
      );
    }

    function AddExpenseSection(props){
      const {isAdmin,selectedDate,setSelectedDate,category,setCategory,categories,amount,setAmount,formError,quickAmounts,comment,setComment,addExpense,Plus,Calendar,TrendingDown,DollarSign,MessageSquare} = props;
      if (isAdmin) return null;
      return (
        <div className="bg-white rounded-2xl shadow-xl p-4 md:p-6 mb-6">
          <h2 className="text-lg md:text-xl font-bold text-gray-800 mb-4 flex items={['center']} gap-2"><Plus size={20} className="text-indigo-600" />Add New Expense</h2>
          {formError && (
            <div className={`p-3 rounded-xl mb-4 ${formError.includes('‚úÖ')?'bg-green-50 border-2 border-green-500 text-green-700':'bg-red-50 border-2 border-red-500 text-red-700'}`}>
              <p className="font-medium text-center text-xs md:text-sm">{formError}</p>
            </div>
          )}
          <div className="grid grid-cols-1 gap-3 md:gap-4">
            <div className="grid grid-cols-2 gap-3">
              <div>
                <label className="block text-xs md:text-sm font-medium text-gray-700 mb-2 flex items-center gap-1"><Calendar size={14} /> Date</label>
                <input type="date" value={selectedDate} onChange={(e)=>setSelectedDate(e.target.value)} className="w-full p-2.5 md:p-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:outline-none text-sm" />
              </div>
              <div>
                <label className="block text-xs md:text-sm font-medium text-gray-700 mb-2 flex items-center gap-1"><TrendingDown size={14} /> Category</label>
                <select value={category} onChange={(e)=>setCategory(e.target.value)} className="w-full p-2.5 md:p-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:outline-none appearance-none bg-white cursor-pointer text-sm">
                  {categories.map(cat => (<option key={cat} value={cat}>{cat}</option>))}
                </select>
              </div>
            </div>
            <div>
              <label className="block text-xs md:text-sm font-medium text-gray-700 mb-2 flex items-center gap-1"><DollarSign size={14} /> Amount (AED)</label>
              <input type="number" value={amount} onChange={(e)=>{ setAmount(e.target.value); }} placeholder="0.00" step="0.01"
                     className="w-full p-2.5 md:p-3 border-2 rounded-xl focus:border-indigo-500 focus:outline-none text-base md:text-lg border-gray-200" />
              <div className="flex gap-1.5 md:gap-2 mt-2">
                {props.quickAmounts.map(amt=>(
                  <button key={amt} onClick={()=>props.setAmount(amt.toString())} className="flex-1 py-1.5 md:py-2 px-2 md:px-3 bg-indigo-50 text-indigo-600 rounded-lg hover:bg-indigo-100 font-medium text-xs md:text-sm transition-all">{amt}</button>
                ))}
              </div>
            </div>
            <div>
              <label className="block text-xs md:text-sm font-medium text-gray-700 mb-2 flex items-center gap-1"><MessageSquare size={14} /> Note (Optional)</label>
              <input type="text" value={comment} onChange={(e)=>setComment(e.target.value)} placeholder="What did you buy?"
                     className="w-full p-2.5 md:p-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:outline-none text-sm" />
            </div>
            <div>
              <button onClick={addExpense} className="w-full bg-indigo-600 text-white py-3 px-6 rounded-xl font-bold hover:bg-indigo-700 transition-all shadow-lg hover:shadow-xl flex items-center justify-center gap-2 text-sm md:text-base">
                <Plus size={18} /> Add Expense
              </button>
            </div>
          </div>
        </div>
      );
    }

    function ExpenseList({isAdmin,filteredExpenses,Trash2,MessageSquare,Calendar,deleteExpense,ShoppingCart}){
      return (
        <div className="bg-white rounded-2xl shadow-xl p-4 md:p-6">
          <h2 className="text-lg md:text-xl font-bold text-gray-800 mb-4">{isAdmin ? 'üìã All Expenses' : 'Recent Expenses'}</h2>
          {filteredExpenses.length === 0 ? (
            <div className="text-center py-12">
              <ShoppingCart size={48} className="mx-auto text-gray-300 mb-4" />
              <p className="text-gray-500">No expenses recorded yet</p>
              {!isAdmin && <p className="text-sm text-gray-400 mt-2">Add your first expense above!</p>}
            </div>
          ) : (
            <div className="space-y-3">
              {filteredExpenses.map(expense=>(
                <div key={expense.id} className="flex flex-col sm:flex-row sm:items-start sm:justify-between p-4 bg-gradient-to-r from-gray-50 to-gray-100 rounded-xl hover:from-indigo-50 hover:to-purple-50 transition-all border-2 border-transparent hover:border-indigo-200">
                  <div className="flex-1 mb-3 sm:mb-0">
                    <div className="flex flex-wrap items-center gap-2 mb-2">
                      <span className="font-bold text-lg md:text-xl text-gray-800">AED {expense.amount.toFixed(2)}</span>
                      <span className="px-2 py-1 bg-indigo-100 text-indigo-700 rounded-full text-xs font-medium">{expense.category}</span>
                      {isAdmin && <span className="px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium">{expense.username}</span>}
                    </div>
                    {expense.comment && (
                      <div className="flex items-start gap-2 mb-2">
                        <MessageSquare size={14} className="text-gray-400 mt-0.5 flex-shrink-0" />
                        <p className="text-xs md:text-sm text-gray-600 italic break-words">"{expense.comment}"</p>
                      </div>
                    )}
                    <div className="flex gap-2 text-xs text-gray-500 flex-wrap">
                      <span className="flex items-center gap-1"><Calendar size={12} /> {new Date(expense.date).toLocaleDateString('en-US', {month:'short', day:'numeric', year:'numeric'})}</span>
                    </div>
                  </div>
                  {!isAdmin && (
                    <button onClick={()=>deleteExpense(expense.id)} className="w-full sm:w-auto sm:ml-4 p-2 text-red-500 bg-red-50 hover:bg-red-100 rounded-lg transition-all text-sm font-medium">
                      <span className="flex items-center justify-center gap-1"><Trash2 size={16} /><span className="sm:hidden">Delete</span></span>
                    </button>
                  )}
                </div>
              ))}
            </div>
          )}
        </div>
      );
    }

    // boot
    const rootEl = document.getElementById('root');
    rootEl.classList.remove('app-loading');
    ReactDOM.createRoot(rootEl).render(<FamilyExpenseTracker />);
  </script>

  <!-- Service worker -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', async () => {
        try {
          const reg = await navigator.serviceWorker.register('./service-worker.js', { scope: './' });
          if (reg.update) reg.update(); // pick up new SW after deploys
          console.log('SW registered:', reg.scope);
        } catch (err) {
          console.log('SW registration failed:', err);
        }
      });
    }
  </script>
</body>
</html>
